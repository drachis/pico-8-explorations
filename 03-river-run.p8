pico-8 cartridge // http://www.pico-8.com
version 42
__lua__

-- Main File

-- Game state
game_state = "playing"
game_over_timer = 0
high_score = 0

#include 03-river-run-utility.lua
#include 03-river-run-enviornment.lua

#include 03-river-run-player.lua
#include 03-river-run-enemies.lua
#include 03-river-run-fuel-depot.lua

#include 03-river-run-ui.lua

function _init()
    init_game()
end

function init_game()
    init_jet()
    init_environment()
    init_enemies()
    init_fuel_depots()
    init_ui()
    game_state = "playing"
    game_over_timer = 0
end

function _update()
    if game_state == "playing" then
        update_jet()
        update_environment()
        update_enemies()
        update_fuel_depots()
        update_ui()
        check_collisions()
        enemy_collisions()
        check_fuel_collisions()
        
        if jet.lives <= 0 then
            game_state = "game_over"
            game_over_timer = 300  -- 5 seconds at 60 FPS
            if jet.score > high_score then
                high_score = jet.score
            end
        end
    elseif game_state == "game_over" then
        game_over_timer = game_over_timer - 1
        if game_over_timer <= 0 then
            init_game()
        end
    end
end

function _draw()
    cls()
    if game_state == "playing" then
        draw_environment()
        draw_jet()
        draw_enemies()
        draw_fuel_depots()
        draw_ui()
    elseif game_state == "game_over" then
        draw_game_over()
    end
end

__label__
33333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccc33333333333333333333333333333333333333
33333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccc33333333333333333333333333333333333333
33333377737373777337733333333377733333333333cccccccccccccccccccccc777cc77c7c7cccccccccc77c37737773777333333333773377737773777333
33733337337373733373333733333333733333333333cccccccccccccccccc7c7cc7cc7ccc7c7cccccc77c7ccc73737373733337333333373333737373737333
33733337337373773377733333333337733333333333cccccccccccccccccc7c7cc7cc7ccc777ccccc7ccc7ccc73737733773333333333373333737373737333
33733337337773733333733733333333733333333333cccccccccccccccccc777cc7cc7c7c7c7ccccccc7c7ccc73737373733337333333373333737373737333
33377377733733777377333333333377733333333333cccccccccccccccccc7c7c777c777c7c7ccccc77ccc77c77337373777333333333777333737773777333
33333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccc33333333333333333333333333333333333333
33333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccc33333333333333333333333333333333333333
33333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccc33333333333333333333333333333333333333
33333337733773777377733333333377737773777333cccccccccccccccccccccccccccccccccccccccccccccc33333333333333333333333333333333333333
33377373337373737373333733333333737373737333cccccccccccccccccccccccccccccccccccccccccccccc33333333333333333333333333333333333333
33733373337373773377333333333377737373737333ccccccccccccccccccc77ccccccccccccccccccccccccc33333333333333333333333333333333333333
33337373337373737373333733333373337373737333ccccccccccccccccccc77ccccccccccccccccccccccccc33333333333333333333333333333333333333
33773337737733737377733333333377737773777333ccccccccccccccccccc77ccccccccccccccccccccccccc33333333333333333333333333333333333333
33333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccc33333333333333333333333333333333333333
3333333333333333333333333333333333333333333ccccccccccccccccccccccccccccccccccccccccccccccccc333333333333333333333333333333333333
3333333333333333333333333333333333333333333ccccccccccccccccccccccccccccccccccccccccccccccccc333333333333333333333333333333333333
3377777777777777777777777777777777733333333ccccccccccccccccccccccccccccccccccccccccccccccccc333333333333333333333333333333333333
3378888888888888888833333333333333733333333ccccccccccccccccccccccccccccccccccccccccccccccccc333333333333333333333333333333333333
3378888888888888888833333333333333733333333ccccccccccccccccccccccccccccccccccccccccccccccccc333333333333333333333333333333333333
3378888888888888888833333333333333733333333ccccccccccccccccccccccccccccccccccccccccccccccccc333333333333333333333333333333333333
3378888888888888888833333333333333733333333ccccccccccccccccccccccccccccccccccccccccccccccccc333333333333333333333333333333333333
3378888888888888888833333333333333733333333ccccccccccccccccccccccccccccccccccccccccccccccccc333333333333333333333333333333333333
3378888888888888888833333333333333733333333ccccccccccccccccccccccccccccccccccccccccccccccccc333333333333333333333333333333333333
3378888888888888888833333333333333733333333ccccccccccccccccccccccccccccccccccccccccccccccccc333333333333333333333333333333333333
3377777777777777777777777777777777733333333ccccccccccccccccccccccccccccccccccccccccccccccccc333333333333333333333333333333333333
3333337373777373333333333333333333333333333ccccccccccccccccccccccccccccccccccccccccccccccccc333333333333333333333333333333333333
3377737373733373333333333333333333333333333ccccccccccccccccccccccccccccccccccccccccccccccccc333333333333333333333333333333333333
3377337373773373333333333333333333333333333ccccccccccccccccccccccccccccccccccccccccccccccccc333333333333333333333333333333888888
3373337373733373333333333333333333333333333cccccccccccccccc77ccccccccccccccccccccccccccccccc333333333333333333333333333333888888
3373333773777377733333333333333333333333333cccccccccccccccc77ccccccccccccccccccccccccccccccc333333333333333333333333333333888888
33333333333333333333333333333333333333333333ccccccccccccccc77ccccccccccccccccccccccccccccccc333333333333333333333333333333888888
33333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccccc333333333333333333333333333333888888
33333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccccc333333333333333333333333333333888888
33333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccccc333333333333333333333333333333888888
33333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccccc333333333333333333333333333333888888
33333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccccc333333333333333333333333333333888888
33333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccccc333333333333333333333333333333333333
33333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccccc333333333333333333333333333333333333
33333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccccc333333333333333333333333333333333333
33333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccccc333333333333333333333333333333333333
33333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccccc333333333333333333333333333333333333
33333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccccc333333333333333333333333333333333333
33333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccccc333333333333333333333333333333333333
33333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccccc333333333333333333333333333333333333
33333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccccc333333333333333333333333333333333333
33333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccccc333333333333333333333333333333333333
333333333333333333333333333333333333333333333ccccccccc77ccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
333333333333333333333333333333333333333333333ccccccccc77ccccccccccccccccccccccccccccccccccc3333333333888888888333333333333333333
333333333333333333333333333333333333333333333ccccccccc77ccccccccccccccccccccccccccccccccccc3333333333888888888333333333333333333
333333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccc3333333333888888888333333333333333333
333333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccc3333333333888888888333333333333333333
333333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccc3333333333888888888333333333333333333
333333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccc3333333333888888888333333333333333333
333333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccc3333333333888888888333333333333333333
333333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccc3333333333888888888333333333333333333
333333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccc3333333333888888888333333333333333333
333333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
333333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
333333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
333333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
333333333333333333333333333333333333333399933cccccccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
333333333333333333333333333333333333339999999cccccccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
333333333333333333333333333333333333339999999cccccccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
3333333333333333333333333333333333333999999999ccccccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
3333333333333333333333333333333333333999999999ccccccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
3333333333333333333333333333333333333999999999ccccccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
333333333333333333333333333333333333339999999cccccccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
333333333333333333333333333333333333339999999cccccccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
33333333333333333333333333333333333333339993ccccccccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
33333333333333333333333333333333333333333333ccccccccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
33333333333333333333333333333333333333333333cccc77ccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
33333333333333333333333333333333333333333333cccc77ccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
33333333333333333333333333333333333333333333cccc77ccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
33333333333333333333333333333333333333333333ccccccccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
33333333333333333333333333333333333333333333ccccccccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
33333333333333333333333333333333333333333333ccccccccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
33333333333333333333333333333333333333333333ccccccccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
33333333333333333333333333333333333333333333ccccccccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
33333333333333333333333333333333333333333333ccccccccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
33333333333333333333333333333333333333333333ccccccccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
33333333333333333333333333333333333333333333ccccccccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
33333333333333333333333333333333333333333333ccccccccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
33333333333333333333333333333333333333333333ccccccccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
33333333333333333333333333333333333333333333ccccccccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
33333333333333333333333333333333333333333333ccccccccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
33333333333333333333333333333333333333333333ccccccccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
33333333333333333333333333333333333333333333ccccccccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
33333333333333333333333333333333333333333333ccccccccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
33333333333333333333333333333333333333333333ccccccccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
33333333333333333333333333333333333333333333ccccccccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
33333333333333333333333333333333333333333333ccccccccccccccccccccccccccccccccccccccccccccccc3333333333333339993333333333333333333
33333333333333333333333333333333333333333333ccccccccccccccccccccccccccccccccccccccccccccccc3333333333333999999933333333333333333
33333333333333333333333333333333333333333333ccccccccccccccccccccccccccccccccccccccccccccccc3333333333333999999933333333333333333
33333333333333333333333333333333333333333333ccccccccccccccccccccccccccccccccccccccccccccccc3333333333339999999993333333333333333
333333333333333333333333333333333333333333ccccccccccccccccccccccccccccccccccccccccccccccccc3333333333339999999993333333333333333
333333333333333333333333333333333333333333ccccccccccccccccccccccccccccccccccccccccccccccccc3333333333339999999993333333333333333
333333333333333333333333333333333333333333ccccccccccccccccccccccccccccccccccccccccccccccccc3333333333333999999933333333333333333
333333333333333333333333333333333333333333ccccccccccccccccccccccccccccccccccccccccccccccccc3333333333333999999933333333333333333
33333333333333333333333333333333333333333bbbbbbbbbccccccccccccccccccccccccccccccccccccccccc3333333333333339993333333333333333333
33333333333333333333333333333333333333333bbbbbbbbbccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
33333333333333333333333333333333333333333bbbbbbbbbccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
33333333333333333333333333333333333333333bbbbbbbbbccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
33333333333333333333333333333333333333333bbbbbbbbbccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
33333333333333333333333333333333333333333bbbbbbbbbccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
33333333333333333333333333333333333333333bbbbbbbbbccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
33333333333333333333333333333333333333333bbbbbbbbbccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
33333333333333333333333333333333333333333bbbbbbbbbccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
333333333333333333333333333333333333333333ccccccccccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
333333333333333333333333333333333333333333ccccccccccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
333333333333333333333333333333333333333333ccccccccccccccccccccccccccccccccccccccccccccccccc3333333333333333333333333333333333333
33333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccc33333333333333333333333333333333333333
33333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccc33333333333333333333333333333333333333
33333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccc33333333333333333333333333333333333333
33333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccc33333333333333333333333333333333333333
33333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccc33333333333333333333333333333333333333
33333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccc33333333333333333333333333333333333333
33333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccc33333333333333333333333333333333333333
33333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccc33333333333333333333333333333333333333
33333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccc33333333333333333333333333333333333333
33333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccc33333333333333333333333333333333333333
33333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccc33333333333333333333333333333333333333
33333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccc3333333333333333333333bbbbbbbbb3333333
33333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccc3333333333333333333333bbbbbbbbb3333333
33333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccc3333333333333333333333bbbbbbbbb3333333
33333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccc3333333333333333333333bbbbbbbbb3333333
33333333333333333333333333333333333333333333cccccccccccccccccccccccccccccccccccccccccccccc3333333333333333333333bbbbbbbbb3333333

